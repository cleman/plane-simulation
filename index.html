<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lancer la Simulation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Simulation de Dynamique</h1>
    
    <form id="simulationForm">
        <!-- Champs pour l'état initial -->
        <h2>État Initial</h2>
        <label for="etat1">Vx :</label><input type="number" id="etat1" name="etat1"><br>
        <label for="etat2">Vy :</label><input type="number" id="etat2" name="etat2"><br>
        <label for="etat3">Vz :</label><input type="number" id="etat3" name="etat3"><br>
        <label for="etat4">Gz :</label><input type="number" id="etat4" name="etat4"><br>
        <label for="etat5">Gy :</label><input type="number" id="etat5" name="etat5"><br>
        <label for="etat6">Gz :</label><input type="number" id="etat6" name="etat6"><br>

        <!-- Champs pour la commande de l'actionneur -->
        <h2>Commande Actionneur</h2>
        <label for="cmd1">RPM mot:</label><input type="number" id="cmd1" name="cmd1"><br>
        <label for="cmd2">Aile G:</label><input type="number" id="cmd2" name="cmd2"><br>
        <label for="cmd3">Aile D:</label><input type="number" id="cmd3" name="cmd3"><br>
        <label for="cmd4">Gouv prof :</label><input type="number" id="cmd4" name="cmd4"><br>
        <label for="cmd5">Gouv dir :</label><input type="number" id="cmd5" name="cmd5"><br>

        <!-- Temps de simulation -->
        <h2>Temps de Simulation</h2>
        <label for="temps">Temps (en secondes):</label><input type="number" id="temps" name="temps"><br>

        <!-- Bouton pour lancer la simulation -->
        <button type="button" onclick="submitForm()">Lancer la Simulation</button>
    </form>

    <h2>Résultats de la Simulation</h2>
    <canvas id="forceChart" width="400" height="200"></canvas>
    <canvas id="accChart" width="400" height="200"></canvas>
    <canvas id="speedChart" width="400" height="200"></canvas>

    <script>
        let accChart;
        let speedChart;
        let forceChart;

        function submitForm() {
            var formData = {
                etat1: parseFloat(document.getElementById('etat1').value),
                etat2: parseFloat(document.getElementById('etat2').value),
                etat3: parseFloat(document.getElementById('etat3').value),
                etat4: parseFloat(document.getElementById('etat4').value),
                etat5: parseFloat(document.getElementById('etat5').value),
                etat6: parseFloat(document.getElementById('etat6').value),
                cmd1: parseFloat(document.getElementById('cmd1').value),
                cmd2: parseFloat(document.getElementById('cmd2').value),
                cmd3: parseFloat(document.getElementById('cmd3').value),
                cmd4: parseFloat(document.getElementById('cmd4').value),
                cmd5: parseFloat(document.getElementById('cmd5').value),
                temps: parseFloat(document.getElementById('temps').value)
            };

            fetch('/start_simulation', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                alert("Simulation terminée !");
                console.log(data);

                if (accChart) accChart.destroy();
                if (speedChart) speedChart.destroy();
                if (forceChart) forceChart.destroy();

                var ctx0 = document.getElementById('accChart').getContext('2d');
                accChart = new Chart(ctx0, {
                    type: 'line',
                    data: {
                        labels: data.time,
                        datasets: [
                            { label: 'Accélération X', data: data.accX, borderColor: 'blue', fill: false },
                            { label: 'Accélération Y', data: data.accY, borderColor: 'red', fill: false },
                            { label: 'Accélération Z', data: data.accZ, borderColor: 'green', fill: false }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: { title: { display: true, text: 'Temps (s)' }},
                            y: { title: { display: true, text: 'Acceleration (m/s^2)' }}
                        }
                    }
                });

                var ctx1 = document.getElementById('speedChart').getContext('2d');
                speedChart = new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: data.time,
                        datasets: [
                            { label: 'Vitesse X', data: data.speedX, borderColor: 'blue', fill: false },
                            { label: 'Vitesse Y', data: data.speedY, borderColor: 'red', fill: false },
                            { label: 'Vitesse Z', data: data.speedZ, borderColor: 'green', fill: false }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: { title: { display: true, text: 'Temps (s)' }},
                            y: { title: { display: true, text: 'Vitesse (m/s)' }}
                        }
                    }
                });

                var ctx2 = document.getElementById('forceChart').getContext('2d');
                forceChart = new Chart(ctx2, {
                    type: 'line',
                    data: {
                        labels: data.time,
                        datasets: [
                            { label: 'Thurst', data: data.thrust, borderColor: 'blue', fill: false },
                            { label: 'Weight', data: data.weight, borderColor: 'red', fill: false },
                            { label: 'Lift 1', data: data.lift1, borderColor: 'purple', fill: false },
                            { label: 'Lift 2', data: data.lift2, borderColor: 'orange', fill: false },
                            { label: 'Lift 3', data: data.lift3, borderColor: 'pink', fill: false },
                            { label: 'Lift 4', data: data.lift4, borderColor: 'brown', fill: false },
                            { label: 'Drag 1', data: data.drag1, borderColor: 'black', fill: false },
                            { label: 'Drag 2', data: data.drag2, borderColor: 'gray', fill: false },
                            { label: 'Drag 3', data: data.drag3, borderColor: 'cyan', fill: false },
                            { label: 'Drag 4', data: data.drag4, borderColor: 'yellow', fill: false }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: { title: { display: true, text: 'Temps (s)' }},
                            y: { title: { display: true, text: 'Forces (N)' }}
                        }
                    }
                });
            })
            .catch(error => {
                alert("Erreur lors du lancement de la simulation");
                console.error(error);
            });

        }
    </script>
</body>
</html>
